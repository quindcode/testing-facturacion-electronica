name:  Screenplay API Architecture Reviewer

on:
  pull_request:
    types: [opened, synchronize]
    paths:
      - '**.java' # Solo se ejecutar谩 si hay cambios en c贸digo Java

jobs:
  screenplay-code-review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write # Necesario para que el bot pueda comentar en el PR

    steps:
      - name: Checkout del c贸digo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Ejecutar AI Code Reviewer
        uses: anc95/ChatGPT-CodeReview@main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OPENAI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          LANGUAGE: Spanish
        with:
          model: gpt-4o-mini # R谩pido y econ贸mico, o gpt-4o para mayor precisi贸n
          # Aqu铆 inyectamos el "cerebro" del l铆der t茅cnico que creamos
          system_message: |
            Eres un Arquitecto de Pruebas Automatizadas revisando un Pull Request de Serenity BDD con Screenplay para APIs (Rest Assured).
            Debes comentar directamente en las l铆neas de c贸digo si detectas violaciones a estas reglas estrictas:
            1. TASKS: Las clases 'Task' NO deben tener aserciones (.then().statusCode(), Ensure, seeThat). Solo construyen y env铆an la petici贸n (Post.to, Get.resource).
            2. MODELS/PAYLOADS: Prohibido concatenar JSON en Strings. Los bodies de las peticiones deben usar objetos Java (POJOs/DTOs/Builders).
            3. AUTH & ESTADO: Prohibido usar variables 'static' para guardar tokens. Obligatorio usar 'actor.remember()' y 'actor.recall()'.
            4. TEST DATA: Prohibido quemar datos 煤nicos (emails, IDs) en el c贸digo. Exige el uso de Factories con Datafaker.
            5. QUESTIONS: Las 'Questions' solo deben leer 'SerenityRest.lastResponse()' sin hacer nuevas peticiones.
            
            Si el c贸digo cumple, no comentes nada. Si viola una regla, s茅 directo, explica la falla arquitect贸nica y sugiere el c贸digo corregido.